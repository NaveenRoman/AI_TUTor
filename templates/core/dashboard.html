<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Tutor ‚Äì Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <style>
        /* ===============================
           GLOBAL RESET
        =============================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", "Segoe UI", sans-serif;
        }

        body {
            background: #f4f7fb;
            display: flex;
            min-height: 100vh;
        }

        /* ===============================
           SIDEBAR
        =============================== */
        .sidebar {
            width: 260px;
            background: #0f172a;
            color: #fff;
            padding: 24px;
            display: flex;
            flex-direction: column;
        }

        .sidebar h2 {
            font-size: 1.6rem;
            text-align: center;
            margin-bottom: 40px;
            letter-spacing: 0.5px;
        }

        .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .nav-links a {
            text-decoration: none;
            color: #cbd5f5;
            padding: 12px 16px;
            border-radius: 10px;
            transition: 0.3s;
        }

        .nav-links a:hover,
        .nav-links a.active {
            background: #1e293b;
            color: #fff;
        }

        /* ===============================
           MAIN CONTENT
        =============================== */
        .main {
            flex: 1;
            padding: 40px;
        }

        /* HEADER */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 1.9rem;
            color: #0f172a;
        }

        .header span {
            color: #6366f1;
        }

        /* ===============================
           SECTION TITLES
        =============================== */
        .section-title {
            font-size: 1.3rem;
            margin: 30px 0 16px;
            color: #0f172a;
        }

        /* ===============================
           CARD GRID
        =============================== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .card {
            background: #fff;
            border-radius: 14px;
            padding: 22px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
        }

        /* ===============================
           DAILY QUIZ CARD
        =============================== */
        .quiz-status {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-status .status {
            font-size: 0.9rem;
            color: #16a34a;
            font-weight: 600;
        }

        .quiz-score {
            font-size: 2.2rem;
            font-weight: 800;
            color: #0f172a;
        }

        .quiz-meta {
            font-size: 0.9rem;
            color: #64748b;
        }

        /* ===============================
           PROGRESS BAR
        =============================== */
        .progress-bar {
            background: #e5e7eb;
            border-radius: 10px;
            height: 10px;
            margin: 8px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #4f46e5);
        }

        /* ===============================
           PERFORMANCE TAGS
        =============================== */
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background: #eef2ff;
            color: #4338ca;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .weak {
            background: #fee2e2;
            color: #b91c1c;
        }

        /* ===============================
           AI SUGGESTION
        =============================== */
        .ai-tip {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: #fff;
        }

        .ai-tip h3 {
            margin-bottom: 10px;
        }

        .ai-tip p {
            font-size: 0.95rem;
            line-height: 1.5;
        }

    </style>
</head>

<body>

<!-- ===============================
     SIDEBAR
=============================== -->
<nav class="sidebar">
    <h2>AI Tutor</h2>

    <ul class="nav-links">
        <li><a href="{% url 'index' %}">üè† Home</a></li>
        <li><a class="active" href="{% url 'dashboard' %}">Dashboard</a></li>
        <li><a href="{% url 'books' %}">My Courses</a></li>
        <li><a href="{% url 'chat' %}">AI Chat</a></li>
        <li><a href="{% url 'my_profile' %}">Progress</a></li>
        <li><a href="{% url 'profile_edit' %}">Settings</a></li>
    </ul>

    <!-- ===============================
         AI INTERVIEW BUTTON
    =============================== -->
    <div style="margin-top:auto;">
        <a href="{% url 'interview' %}">
            <button style="
                width:100%;
                background:#6366f1;
                color:white;
                border:none;
                padding:14px 22px;
                font-size:16px;
                border-radius:12px;
                cursor:pointer;
                font-weight:700;
            ">
                üé§ Start AI Interview
            </button>
        </a>
    </div>
</nav>


<!-- ===============================
     MAIN CONTENT
=============================== -->

<main class="main">

  <!-- HEADER -->
  <div class="header">
    <h1>Welcome back, <span>{{ request.user.username }}</span> üëã</h1>
  </div>

  <!-- DAILY QUIZ -->
  <h2 class="section-title">üìò Daily Quiz</h2>
  <div class="grid">
    <div class="card quiz-status">
      <div class="status">‚úî Attempted Today</div>
      <div class="quiz-score">{{ today_score|default:"0" }}%</div>
      <div class="quiz-meta">
        Streak: üî• {{ streak }} days
      </div>
    </div>
  </div>

  <!-- COURSE PROGRESS -->
  <h2 class="section-title">üìö Course Progress</h2>
  <div class="grid">
  <div class="card">
    <strong>{{ books_started }}</strong> course(s) started<br><br>
    <strong>{{ completed_count }}</strong> topic(s) completed<br><br>
    Overall Progress: {{ overall_course_percent }}%
  </div>
</div>


  <!-- PERFORMANCE SNAPSHOT -->
  <h2 class="section-title">üìà Performance Snapshot</h2>
  <div class="grid">
    <div class="card">
      <h3>Average Score</h3>
      <p style="font-size:2rem;font-weight:800">{{ avg_score }}%</p>
    </div>

    <div class="card">
      <h3>Strong Topics</h3>
      <div class="tags">
        {% for t in strong_topics %}
          <span class="tag">{{ t.topic }}</span>
        {% empty %}
          <span>No strong topics yet</span>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <h3>Weak Topics</h3>
      <div class="tags">
        {% for t in weak_topics %}
          <span class="tag weak">{{ t.topic }}</span>
        {% empty %}
          <span>Doing great!</span>
        {% endfor %}
      </div>
    </div>
  </div>

<h2 class="section-title">üß† Skill Intelligence</h2>
<div class="grid">
  <div class="card">
    <h3>Readiness Score</h3>
    <p style="font-size:2rem;font-weight:800">
      {{ skill_profile.readiness_score|default:"0" }}%
    </p>

    {% if weekly_growth > 0 %}
  <p style="color:#22c55e;font-weight:600;">
    ‚Üë {{ weekly_growth }}% this week
  </p>
{% elif weekly_growth < 0 %}
  <p style="color:#ef4444;font-weight:600;">
    ‚Üì {{ weekly_growth|floatformat:2 }}% this week
  </p>
{% else %}
  <p style="color:#64748b;">
    No change this week
  </p>
{% endif %}

  </div>

  <div class="card">
    <canvas id="skillRadar" height="250"></canvas>
  </div>
</div>



  <!-- AI SUGGESTION -->
  <h2 class="section-title">üß† AI Suggestion</h2>
  <div class="grid">
    <div class="card ai-tip">
      <h3>Personalized Tip</h3>
      <p>Keep practicing regularly and review your weak areas.</p>

    </div>
  </div>

  <h2 class="section-title">üìä Platform Metrics</h2>
<div class="grid">
  <div class="card">
    <h3>Total Interviews</h3>
    <p style="font-size:1.8rem;font-weight:700">
      {{ total_interviews }}
    </p>
  </div>

  <div class="card">
    <h3>Daily Active Users</h3>
    <p style="font-size:1.8rem;font-weight:700">
      {{ daily_active_users }}
    </p>
  </div>

  <div class="card">
    <h3>Avg Improvement %</h3>
    <p style="font-size:1.8rem;font-weight:700">
      {{ avg_improvement }}%
    </p>
  </div>
</div>

{% if latest_session %}
<h2 class="section-title">üß† Behavioral Intelligence</h2>

<div class="grid">
  <div class="card">
    <h3>Performance Trend</h3>
    <p style="font-size:1.5rem;font-weight:700;">
      {{ latest_session.performance_slope }}
    </p>
  </div>

  <div class="card">
    <h3>Consistency Score</h3>
    <p style="font-size:1.5rem;font-weight:700;">
      {{ latest_session.consistency_score }}%
    </p>
  </div>

  <div class="card">
    <h3>Confidence Trend</h3>
    <p style="font-size:1.5rem;font-weight:700;">
      {{ latest_session.confidence_trend }}
    </p>
  </div>

  <div class="card">
    <h3>Risk Status</h3>

    {% if latest_session.risk_flag %}
      <p style="color:#ef4444;font-weight:700;">
        ‚ö† At Risk ‚Äì Needs Improvement
      </p>
    {% else %}
      <p style="color:#22c55e;font-weight:700;">
        ‚úÖ Stable Performance
      </p>
    {% endif %}
  </div>
</div>
{% endif %}


  <!-- STUDY PLAN -->
  <div class="card">
   <h3>üìÖ Tomorrow‚Äôs Study Plan</h3>
    <ul>
    {% for plan in study_plan %}
      <li>{{ plan }}</li>
    {% empty %}
      <li>You‚Äôre doing great! Keep revising.</li>
    {% endfor %}
    </ul>

   </div>

  
  <!-- WEEKLY PERFORMANCE -->
  <!-- WEEKLY PERFORMANCE -->
<h2 class="section-title">üìä Weekly Performance Trend</h2>
{{ weekly_labels|json_script:"weekly-labels-data" }}
{{ weekly_scores|json_script:"weekly-scores-data" }}
{{ skill|json_script:"skill-data" }}




<div class="card">
  <canvas id="weeklyChart" height="90"></canvas>
</div>


<div class="quiz-score">{{ today_score|default:"0" }}%</div>


<!-- DAILY STREAK -->
<h2 class="section-title">üî• Daily Streak (Last 7 Days)</h2>

{{ streak_labels|json_script:"streak-labels-data" }}
{{ streak_values|json_script:"streak-values-data" }}
{{ skill|json_script:"skill-data" }}




<div class="card">
  <canvas id="streakChart" height="90"></canvas>
</div>


  <div class="card">
  <h3>üèÜ Comparison</h3>
  <p style="font-size:1.8rem;font-weight:700">
    You are better than {{ percentile }}% learners
  </p></div>


  <select id="role">
  <option>Java Developer</option>
  <option>Python Developer</option>
</select>

<select id="company">
  <option>Amazon</option>
  <option>Google</option>
</select>

<button onclick="startInterview()">Start Interview</button>

<div id="question"></div>

<script>
function startInterview() {
  fetch("/api/interview/start/", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      role: document.getElementById("role").value,
      company: document.getElementById("company").value
    })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("question").innerText = data.question;
  });
}
</script>



</main>

<script>
const weeklyLabels = JSON.parse(
  document.getElementById("weekly-labels-data").textContent
);

const weeklyScores = JSON.parse(
  document.getElementById("weekly-scores-data").textContent
);

if (weeklyLabels.length > 0) {
  new Chart(document.getElementById("weeklyChart"), {
    type: "line",
    data: {
      labels: weeklyLabels,
      datasets: [{
        label: "Score %",
        data: weeklyScores,
        borderColor: "#6366f1",
        backgroundColor: "rgba(99,102,241,0.15)",
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}
</script>





<script>
const streakLabels = JSON.parse(
  document.getElementById("streak-labels-data").textContent
);

const streakValues = JSON.parse(
  document.getElementById("streak-values-data").textContent
);

if (streakLabels.length > 0) {
  new Chart(document.getElementById("streakChart"), {
    type: "bar",
    data: {
      labels: streakLabels,
      datasets: [{
        label: "Attempted",
        data: streakValues,
        backgroundColor: "#6366f1",
        borderRadius: 6
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            callback: v => v === 1 ? "Yes" : "No"
          }
        }
      }
    }
  });
}
</script>




<script>
document.querySelectorAll(".progress-fill").forEach(el => {
  const value = el.dataset.progress;
  if (value) {
    el.style.width = value + "%";
  }
});
</script>

<script>
const skillData = JSON.parse(
  document.getElementById("skill-data").textContent
);

const readiness = skillData.readiness_score || 0;



// Color logic
let radarColor = "rgba(239,68,68,0.6)"; // red default

if (readiness >= 70) {
  radarColor = "rgba(34,197,94,0.6)"; // green
} else if (readiness >= 40) {
  radarColor = "rgba(249,115,22,0.6)"; // orange
}

function safe(v){
  return Math.max(v || 0, 5); // minimum visual fill
}

new Chart(document.getElementById("skillRadar"), {
  type: "radar",
  data: {
    labels: ["Technical", "Communication", "Confidence", "Accuracy", "Consistency"],
    datasets: [{
      label: "Skill Profile",
      data: [
        safe(skillData.technical_score),
        safe(skillData.communication_score),
        safe(skillData.confidence_score),
        safe(skillData.accuracy_score),
        safe(skillData.consistency_score)
      ],
      fill: true,
      backgroundColor: radarColor,
      borderColor: radarColor
    }]
  },
  options: {
    scales: {
      r: {
        min: 0,
        max: 100
      }
    }
  }
});
</script>





</body>
</html>
